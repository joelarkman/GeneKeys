{% extends 'main/base.html' %}


{% block stylesheet %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/dataTables.semanticui.min.css">
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/dataTables.semanticui.min.js"></script>
{% endblock stylesheet %}

{% block javascript %}
<script>
    $('.tables.menu .item').tab({
        alwaysRefresh: true,
        cache: false,
    });

    $.extend(true, $.fn.dataTable.defaults, {
        "ordering": true
    });

    $(document).ready(function () {
        $('#active-keys-table').DataTable();
    });

    $(document).ready(function () {
        $('#archived-keys-table').DataTable();
    });

    $(document).ready(function () {
        $('#gene-transcripts').DataTable({
            "autoWidth": false
        });
    });

    $(function () {

        /* Functions */

        var loadForm = function () {
            var btn = $(this);
            $.ajax({
                url: btn.attr("data-url"),
                type: 'get',
                dataType: 'json',
                beforeSend: function () {
                    $('#modal-keys').modal({
                        centered: false
                    }).modal('show');
                },
                success: function (data) {
                    $("#modal-keys .modal-stuff").html(data.html_form);
                }
            });
        };

        var saveForm = function () {
            var form = $(this);
            $.ajax({
                url: form.attr("action"),
                data: form.serialize(),
                type: form.attr("method"),
                dataType: 'json',
                success: function (data) {
                    if (data.form_is_valid) {
                        $("#active-keys-table tbody").html(data.html_key_list_active);
                        $("#archived-keys-table tbody").html(data.html_key_list_archived);
                        $("#modal-keys").modal("hide");
                    }
                    else {
                        $("#modal-keys .modal-stuff").html(data.html_form);
                    }
                }
            });
            return false;
        };

        $("#active-keys-table").on("click", ".js-archive-key", loadForm);
        $("#modal-keys").on("submit", ".js-key-archive-form", saveForm);
    });
</script>
{% endblock javascript%}

{% block content %}
<div class="ui main container">

    <!-- Constant Buttons -->
    <div class="ui segment">
        <div class="ui three item menu">
            <a href="{% url 'add_key' panel.pk %}" class="item">Add key</a>
            <a class="item">Pending keys</a>
            <a class="item">Generate output files</a>
        </div>
    </div>

    <!-- Breadcrumb -->
    <div class="ui mini two top attached steps">
        <a class="step" href="{% url 'main-home' %}">
            <div class="content">
                <div class="title">Select Panel</div>
            </div>
        </a>
        <div class="active step">
            <div class="content">
                <div class="title">{{ panel.name }}</div>
            </div>
        </div>
    </div>

    <!-- Main section -->
    <div class=" attached ui segment">

        <!-- Panel information -->
        <h1>{{ panel.name }} Panel</h1>
        <p>{{ panel.description }}</p>


        <!-- Tab menu -->
        <div class="ui pointing secondary menu tables">
            <a class="active item" data-tab="active-keys">Active keys</a>
            <a class="item" data-tab="archived-keys">Archived keys</a>
            <a class="item" data-tab="gene-transcripts">Gene/transcript list</a>
        </div>

        <!-- Active keys tab -->
        <div class="ui tab" data-tab="active-keys">
            <table id="active-keys-table" class="ui celled table" style="table-layout: fixed; width:100%">
                <colgroup>
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: 150px">
                </colgroup>
                <thead>
                    <tr>
                        <th>Gene Key</th>
                        <th>Genes</th>
                        <th>Date Added</th>
                        <th>Added by</th>
                        <th>Archive</th>
                    </tr>
                </thead>
                <tbody>
                    {% include 'main/includes/partial_key_list_active.html' %}
                </tbody>
            </table>
        </div>

        <!-- Archived keys tab -->
        <div class="ui tab" data-tab="archived-keys">
            <table id="archived-keys-table" class="ui celled table" style="width:100%">
                <thead>
                    <tr>
                        <th>Gene Key</th>
                        <th>Genes</th>
                        <th>Date Added</th>
                        <th>Added by</th>
                    </tr>
                </thead>
                <tbody>
                    {% include 'main/includes/partial_key_list_archived.html' %}
                </tbody>
            </table>
        </div>

        <!-- Gene/transcripts tab -->
        <div class="ui tab" data-tab="gene-transcripts">
            <table id="gene-transcripts" class="ui celled table" style="table-layout: fixed; width:100%">
                <colgroup>
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: 150px">
                </colgroup>
                <thead>
                    <tr>
                        <th>Genes</th>
                        <th>Selected Transcript</th>
                        <th>Edit</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in panel_genes %}
                    <tr>
                        <td data-label="Genes">{{ entry.gene }}</td>
                        <td data-label="Selected Transcript">{{ entry.transcript }}</td>
                        <td data-label="Edit" class="ui center aligned"><a href="#" class="ui primary button">Edit</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

<div id='modal-keys' class="ui small modal">
    <div class="modal-stuff">
    </div>
</div>

{% endblock content %}